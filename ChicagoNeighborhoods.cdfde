{"components":{"rows":[{"id":"CUSTOMCOMPONENTS","name":"Custom","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"Custom"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"75e6cb0b-dc20-9082-39a7-cb8634a0b046","parent":"CUSTOMCOMPONENTS","properties":[{"name":"name","type":"Id","value":"map"},{"name":"parameter","type":"Parameter","value":""},{"name":"listeners","type":"Listeners","value":"[]"},{"name":"API_KEY","type":"String","value":"0"},{"name":"centerLatitude","type":"Float","value":"41.8781"},{"name":"centerLongitude","type":"Float","value":"-87.6298"},{"name":"cggGraphParameters","type":"ValuesArray","value":"[]"},{"name":"colormap","type":"Array","value":"[]"},{"name":"defaultZoomLevel","type":"Integer","value":"11"},{"name":"fillOpacity","type":"Float","value":""},{"name":"locationResolver","type":"locationResolverCustom","value":"openstreetmap"},{"name":"mapEngineType","type":"mapEngineTypeCustom","value":"openlayers"},{"name":"mapMode","type":"mapModeCustom","value":"shapes"},{"name":"marker","type":"String","value":""},{"name":"markerCggGraph","type":"String","value":""},{"name":"markerClickFunction","type":"JavaScript","value":""},{"name":"markerHeight","type":"Integer","value":25},{"name":"markerWidth","type":"Integer","value":25},{"name":"parameters","type":"ValuesArray","value":"[]"},{"name":"popupContentsDiv","type":"String","value":""},{"name":"popupHeight","type":"Integer","value":250},{"name":"popupParameters","type":"ValuesArray","value":"[]"},{"name":"popupWidth","type":"Integer","value":250},{"name":"shapeSource","type":"String","value":""},{"name":"strokeColor","type":"String","value":""},{"name":"strokeWidth","type":"Float","value":""},{"name":"tilesets","type":"tilesetsCustom","value":"default"},{"name":"dataSource","type":"Datasource","value":"CrimeCounts"},{"name":"priority","type":"Integer","value":5},{"name":"htmlObject","type":"HtmlObject","value":"${h:mapObj}"},{"name":"executeAtStart","type":"Boolean","value":"true"},{"name":"preExecution","type":"JavaScript","value":"function() {\r\n    /*\r\n    * Load the map definition from a GeoJSON file.\r\n    * It\u0027s only rendered in the map those features contained in the resultset.\r\n    */\r\n    var getResource = this.dashboard.getWebAppPath() + \u0027/plugin/pentaho-cdf-dd/api/resources\u0027;\r\n    var mapDef = \u0027${solution:resources/geojson/community-areas-current-geojson.js}\u0027;\r\n\r\n    this.shapeResolver = \u0027geoJSON\u0027;\r\n\tthis.setAddInOptions(\u0027ShapeResolver\u0027, \u0027geoJSON\u0027, {\r\n\t\t//BA server does not recognize the .geojson extension\r\n        url: getResource + mapDef, \r\n\t\t//GeoJSON feature property that will be used to index the feature\r\n        idPropertyName: \u0027area_num_1\u0027 \r\n    });\r\n    \r\n    /*\r\n    * The NMC needs to know what columns in the resultset define\r\n    * the id, that will be matched with the mapDefinition, and\r\n    * what column represent the value used to match the color.\r\n    *\r\n    * There are two ways to do that.\r\n    *   1 - Have two columns the in resultset called id and fill.\r\n    *   2 - Use the visualRoles to set which columns (base 0) represent the id and fill values.\r\n    */\r\n    this.visualRoles = {\r\n        // communityarea\r\n        id: 0,\r\n        // crimes\r\n        fill: 1\r\n    };\r\n    \r\n    /* idk what this does or if I set it up correctly\r\n    this.scales = {\r\n        fill: \u0022default\u0022,\r\n        r: [10, 10000]\r\n    }\r\n    */\r\n    \r\n    /*\r\n    * Define a customized fillColor function.\r\n    * Any feature attribute can be changed or created by this way.\r\n    */\r\n    this.attributeMapping.fill = function(context, seriesRoot, mapping, row) {\r\n        var value = row[mapping.fill];\r\n\r\n        if (_.isNumber(value)) {\r\n            return this.mapColor(value,\r\n                0,\r\n                17336,\r\n                this.getColorMap()\r\n            );\r\n        }\r\n    };\r\n    \r\n    /*\r\n    * Configure a handler for shape mouseover\r\n    */\r\n    this.off(\u0022shape:mouseover\u0022).on(\u0022shape:mouseover\u0022, function(e){\r\n        $(\u0027#popupObj\u0027).show();\r\n        this.currentFeatureOver = e;\r\n    });\r\n\r\n    this.off(\u0022shape:mouseout\u0022).on(\u0022shape:mouseout\u0022, function(e){\r\n        $(\u0027#popupObj\u0027).hide();\r\n        this.currentFeatureOver = null;\r\n    });\r\n    \r\n    /*\r\n    * If defined a click event, change the cursor\r\n    */\r\n    this.styleMap = {\r\n            shapes: {\r\n                cursor: \u0022default\u0022\r\n            }\r\n    };  \r\n} "},{"name":"postExecution","type":"JavaScript","value":"function tooltipOnHover() {\r\n    /* TOOLTIP ON MOUSE HOVER 2 */\r\n\tvar me = this;\r\n\t/*\r\n\t** Define events for mouse move\r\n\t**/\r\n\r\n\tthis.mapEngine.map.events.register(\u0027mousemove\u0027, this.mapEngine.map, function (e) {\r\n\r\n\t\tif (!_.isEmpty(me.currentFeatureOver)) {\r\n\r\n\t\t\tvar modelItem = me.mapEngine.model.findWhere({\r\n\t\t\t\tid: me.currentFeatureOver.id\r\n\t\t\t});\r\n\r\n\t\t\t$(\u0027#popupObj\u0027)\r\n\t\t\t\t.css(\u0027top\u0027, e.pageY -50)\r\n\t\t\t\t.css(\u0027left\u0027, e.pageX + 5)\r\n\t\t\t\t// html contained in popup\r\n\t\t\t\t.html(\r\n\t\t\t\t\tmodelItem.id + \u0027\u003Cbr\u003Ecrimes: \u0027 + modelItem.attributes.data.crimes + \u0027\u0027\r\n\t\t\t\t);\r\n\r\n\t\t}\r\n\t});\r\n\r\n\tthis.mapEngine.map.events.register(\u0027movestart\u0027, this.mapEngine.map, function (e) {\r\n\t\t$(\u0027#popupObj\u0027).fadeIn(500);\r\n\t});\r\n\r\n\tthis.mapEngine.map.events.register(\u0027moveend\u0027, this.mapEngine.map, function (e) {\r\n\t\t$(\u0027#popupObj\u0027).fadeOut(500);\r\n\t});    \r\n\r\n} "},{"name":"postFetch","type":"JavaScript","value":""},{"name":"preChange","type":"JavaScript","value":""},{"name":"postChange","type":"JavaScript","value":""},{"name":"tooltip","type":"Html","value":""},{"name":"shapeMouseClick","type":"JavaScript","value":""},{"name":"shapeMouseOut","type":"JavaScript","value":""},{"name":"shapeMouseOver","type":"JavaScript","value":""}],"rowName":"NewMapComponent","type":"ComponentsNewMapComponent","typeDesc":"Map Component"}]},"datasources":{"rows":[{"id":"SCRIPTING","name":"SCRIPTING Queries","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"SCRIPTING Queries"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"7f64fdab-9b22-7ba4-c112-70983e78d8a2","meta":"CDA","meta_conntype":"scripting.scripting","meta_datype":"jsonScriptable","parent":"SCRIPTING","properties":[{"name":"name","type":"Id","value":"markersDS"},{"name":"initscript","type":"String","value":""},{"name":"language","type":"String","value":"beanshell"},{"name":"access","type":"Access","value":"public"},{"name":"query","type":"JsonScriptableQuery","value":"{  \r\n   \u0022metadata\u0022:[ \r\n      {\u0022colName\u0022:\u0022id\u0022, \u0022colType\u0022:\u0022Integer\u0022, \u0022colIndex\u0022:0},\r\n      {\u0022colName\u0022:\u0022fill\u0022, \u0022colType\u0022:\u0022Integer\u0022, \u0022colIndex\u0022:1},\r\n      {\u0022colName\u0022:\u0022value\u0022, \u0022colType\u0022:\u0022Integer\u0022, \u0022colIndex\u0022:2}\r\n   ],\r\n   \u0022resultset\u0022:[  \r\n      [1, 25, 45],\r\n      [77, 5, 5]\r\n   ]\r\n}"},{"name":"parameters","type":"CdaParameters","value":"[]"},{"name":"cdacalculatedcolumns","type":"CdaCalculatedColumnsArray","value":"[]"},{"name":"cdacolumns","type":"CdaColumnsArray","value":"[]"},{"name":"output","type":"IndexArray","value":"[]"},{"name":"outputMode","type":"OutputMode","value":"include"},{"name":"cacheKeys","type":"CacheKeysValues","value":"[]"},{"name":"cacheDuration","type":"Integer","value":3600},{"name":"cache","type":"Boolean","value":"true"}],"rowName":"jsonScriptable over scripting","type":"ComponentsjsonScriptable_scripting","typeDesc":"jsonScriptable over scripting"},{"id":"KETTLE","name":"KETTLE Queries","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"KETTLE Queries"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"39b60210-7de7-2513-e2d6-6366568d8370","meta":"CDA","meta_conntype":"kettle.TransFromFile","meta_datype":"kettle","parent":"KETTLE","properties":[{"name":"name","type":"Id","value":"CrimeCounts"},{"name":"ktrFile","type":"KtrPath","value":"resources/ktr/loadChicagoCrime.ktr"},{"name":"access","type":"Access","value":"public"},{"name":"query","type":"DefaultQuery","value":"output"},{"name":"parameters","type":"CdaParameters","value":"[[\u0022year\u0022,\u00222015\u0022,\u0022Integer\u0022,\u0022\u0022,\u0022\u0022]]"},{"name":"variables","type":"VariablesValues","value":"[[\u0022year\u0022,\u0022year\u0022]]"},{"name":"cdacalculatedcolumns","type":"CdaCalculatedColumnsArray","value":"[]"},{"name":"cdacolumns","type":"CdaColumnsArray","value":"[]"},{"name":"output","type":"IndexArray","value":"[]"},{"name":"outputMode","type":"OutputMode","value":"include"},{"name":"cacheKeys","type":"CacheKeysValues","value":"[]"},{"name":"cacheDuration","type":"Integer","value":3600},{"name":"cache","type":"Boolean","value":"true"}],"rowName":"kettle over kettleTransFromFile","type":"Componentskettle_kettleTransFromFile","typeDesc":"kettle over kettleTransFromFile"}]},"filename":"/public/NMC-demo/ChicagoNeighborhoods.cdfde","layout":{"rows":[{"id":"7c389aa4-0663-6cf5-9e71-b153176a3c41","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"tooltipOnHover"},{"name":"resourceFile","type":"ResourceFile","value":"${solution:resources/js/tooltipOnHover.js}"},{"name":"resourceType","type":"Label","value":"Javascript"}],"type":"LayoutResourceFile","typeDesc":"Resource"},{"id":"bb46b3cb-1b23-b7d2-6371-1c2cb105faa3","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"colorMapFunction"},{"name":"resourceCode","type":"Resource","value":"define([\u0027amd!cdf/lib/underscore\u0027],function(_){\r\n    \r\n  var colorMapManager = {\r\n\r\n    getColorMap: function (colorMap) {\r\n      var cmap = [];\r\n      colorMap = _.map(colorMap, color2array);\r\n      for (k = 1, L = colorMap.length; k \u003C L; k++) {\r\n        cmap = cmap.concat(interpolate(colorMap[k - 1], colorMap[k], 32));\r\n      }\r\n      return _.map(cmap, function (v) {\r\n        return \u0027rgba(\u0027 + v.join(\u0027,\u0027) + \u0027)\u0027;\r\n      });\r\n    },\r\n\r\n    mapColor: function (value, minValue, maxValue, colormap) {\r\n      var n = colormap.length;\r\n      var level = (value - minValue) / (maxValue - minValue);\r\n      return colormap[Math.floor(level * (n - 1))];\r\n    },\r\n    toGrayscale: function (color) {\r\n      var rgba = color2array(color);\r\n      var g = Math.round(0.2989 * rgba[0] + 0.5870 * rgba[1] + 0.1140 * rgba[2]);\r\n      var v = [g, g, g, rgba[3]];\r\n      return \u0027rgba(\u0027 + v.join(\u0027,\u0027) + \u0027)\u0027;\r\n    }\r\n  };\r\n\r\n  function color2array(color) {\r\n    var rgba = _.clone(color);\r\n    if (_.isArray(color)) {\r\n      rgba = color;\r\n      if (rgba.length === 3) {\r\n        rgba.push(1)\r\n      }\r\n    } else if (_.isString(color)) {\r\n      if (color[0] === \u0022#\u0022) {\r\n        rgba = [parseInt(color.substring(1, 3), 16), parseInt(color.substring(3, 5), 16), parseInt(color.substring(5, 7), 16), 1];\r\n      } else if (color.substring(0,4) === \u0022rgba\u0022) {\r\n        rgba = color.slice(5, -1).split(\u0027,\u0027).map(parseFloat); // assume rgba(R,G,B,A) format\r\n      }\r\n    }\r\n    return rgba;\r\n  }\r\n\r\n\r\n  function interpolate(a, b, n) {\r\n    var colormap = [], d = [];\r\n    var k, kk, step;\r\n    for (k = 0; k \u003C a.length; k++) {\r\n      colormap[k] = [];\r\n      for (kk = 0, step = (b[k] - a[k]) / n; kk \u003C n; kk++) {\r\n        colormap[k][kk] = a[k] + kk * step;\r\n      }\r\n    }\r\n    for (k = 0; k \u003C colormap[0].length \u0026\u0026 k \u003C 3; k++) {\r\n      d[k] = [];\r\n      for (kk = 0; kk \u003C colormap.length; kk++) {\r\n        d[k][kk] = Math.round(colormap[kk][k]);\r\n      }\r\n    }\r\n    return d;\r\n  }\r\n  \r\n  \r\n  /*\r\n  Module Export\r\n  */\r\n  return colorMapManager;\r\n    \r\n}); "},{"name":"resourceType","type":"Label","value":"Javascript"}],"type":"LayoutResourceCode","typeDesc":"Resource"},{"id":"2dbc3d48-6919-654c-4b91-75b3c975da70","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"tooltipCss"},{"name":"resourceCode","type":"Resource","value":"#popupObj {\r\n position:absolute;\r\n background:white;\r\n z-Index:1000;\r\n padding:5px;\r\n border-radius:5px;\r\n border: 1px solid grey;\r\n display: none;\r\n} "},{"name":"resourceType","type":"Label","value":"Css"}],"type":"LayoutResourceCode","typeDesc":"Resource"},{"id":"2b44ea60-4134-af2b-8fb2-f5abb647275f","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"css"},{"name":"resourceCode","type":"Resource","value":"#controls {\n    float: left;\n    text-align: right;\n}\n#eventsLogID {\n    text-align: left;\n    width: 350px;\n    height: 475px;\n    overflow: auto;\n} "},{"name":"resourceType","type":"Label","value":"Css"}],"type":"LayoutResourceCode","typeDesc":"Resource"},{"id":"3aa2f403-96ee-d90a-f743-38b406ddaf91","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":""},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutRow","typeDesc":"Row"},{"id":"a3c824f9-d038-ba78-4875-df95b3d7295b","parent":"3aa2f403-96ee-d90a-f743-38b406ddaf91","properties":[{"name":"name","type":"Id","value":"mapObj"},{"name":"columnSpan","type":"Integer","value":"8"},{"name":"columnPrepend","type":"Integer","value":""},{"name":"columnAppend","type":"Integer","value":""},{"name":"columnPrependTop","type":"Boolean","value":"false"},{"name":"columnAppendBottom","type":"Boolean","value":"false"},{"name":"columnBorder","type":"Boolean","value":"false"},{"name":"columnBigBorder","type":"Boolean","value":"false"},{"name":"height","type":"Integer","value":"500"},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutColumn","typeDesc":"Column"},{"id":"54b1470e-065a-86c1-b85a-7dcd41d2f757","parent":"3aa2f403-96ee-d90a-f743-38b406ddaf91","properties":[{"name":"name","type":"Id","value":"controls"},{"name":"bootstrapExtraSmall","type":"String","value":"4"},{"name":"bootstrapSmall","type":"String","value":""},{"name":"bootstrapMedium","type":"String","value":""},{"name":"bootstrapLarge","type":"String","value":""},{"name":"bootstrapCssClass","type":"String","value":""},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutBootstrapColumn","typeDesc":"Column"},{"id":"94a63b70-8284-67f6-7263-1efee62998a2","parent":"54b1470e-065a-86c1-b85a-7dcd41d2f757","properties":[{"name":"name","type":"Id","value":""},{"name":"html","type":"Html","value":"\u003Cdiv id=\u0022eventsLogID\u0022\u003E\n    \u003Cb\u003EEvents Log:\u003C/b\u003E\n\u003C/div\u003E "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"},{"id":"bb6b15be-b419-75b3-0fab-b760cb784753","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"popupObj"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutRow","typeDesc":"Row"},{"id":"dee3ef3e-67b4-4c8e-9701-17055102e4d4","parent":"bb6b15be-b419-75b3-0fab-b760cb784753","properties":[{"name":"name","type":"Id","value":""},{"name":"bootstrapExtraSmall","type":"String","value":"12"},{"name":"bootstrapSmall","type":"String","value":""},{"name":"bootstrapMedium","type":"String","value":""},{"name":"bootstrapLarge","type":"String","value":""},{"name":"bootstrapCssClass","type":"String","value":""},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutBootstrapColumn","typeDesc":"Column"},{"id":"68d43e3f-2af1-8014-b05a-eab843776ff6","parent":"dee3ef3e-67b4-4c8e-9701-17055102e4d4","properties":[{"name":"name","type":"Id","value":""},{"name":"html","type":"Html","value":"ola "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"}],"title":"CDF - Sample structure"}}